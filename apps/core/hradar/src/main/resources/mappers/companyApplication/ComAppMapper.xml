<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.hit.hradar.domain.companyApplication.query.mapper.ComAppQueryMapper">

  <!-- 회사 신청 목록 조회 -->
  <select id="findList"
    parameterType="org.hit.hradar.domain.companyApplication.query.dto.ComAppSearchRequest"
    resultType="org.hit.hradar.domain.companyApplication.query.dto.ComAppListItemResponse">

    SELECT
    a.application_id      AS appId,
    a.company_name        AS companyName,
    c.company_code        AS companyCode,
    a.biz_no              AS bizNo,
    a.company_telephone   AS comTel,
    a.address             AS address,

    a.creater_name        AS createrName,
    a.creater_email       AS createrEmail,
    a.creater_login_id    AS createrLoginId,

    a.status              AS status,
    a.reviewed_at         AS reviewedAt,
    a.reviewed_by         AS reviewedBy,
    a.reject_reason       AS rejectReason
    FROM company_application a
    LEFT JOIN company c ON a.application_id = c.application_id
    WHERE 1=1

    <if test="status != null and status != ''">
      AND a.status = #{status}
    </if>

    <if test="companyName != null and companyName != ''">
      AND a.company_name LIKE CONCAT('%', #{companyName}, '%')
    </if>

    <if test="bizNo != null and bizNo != ''">
      AND a.biz_no = #{bizNo}
    </if>

    ORDER BY a.application_id DESC
  </select>

  <!-- 회사 신청 상세 조회 -->
  <select id="findDetail"
    resultType="org.hit.hradar.domain.companyApplication.query.dto.ComAppDetailResponse">

    SELECT
    a.application_id      AS applicationId,

    a.company_name        AS comName,
    c.company_code        AS comCode,
    a.biz_no              AS bizNo,
    a.company_telephone   AS comTel,
    a.address             AS address,

    a.status              AS status,

    a.creater_name        AS comAdminName,
    a.creater_email       AS comAdminEmail,
    a.creater_login_id    AS comAdminLoginId,

    a.reviewed_at         AS reviewedAt,
    a.reviewed_by         AS reviewedBy,
    a.reject_reason       AS rejectReason


    FROM company_application a
    LEFT JOIN company c ON a.application_id = c.application_id
    WHERE a.application_id = #{applicationId}
  </select>

</mapper>
