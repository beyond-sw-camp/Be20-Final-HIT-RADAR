<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.hit.hradar.domain.evaluation.query.mapper.RejectionChartMapper">

    <select id="selectMonthlyRejectionCount"
            resultType="org.hit.hradar.domain.evaluation.query.dto.response.row.MonthlyRejectionCountRow">

        SELECT
            DATE_FORMAT(rejected_at, '%Y-%m') AS month,
            COUNT(*) AS count
        FROM rejection_event
        WHERE emp_id = #{empId}
          AND rejected_at BETWEEN
            STR_TO_DATE(CONCAT(#{startYm}, '-01'), '%Y-%m-%d')
            AND LAST_DAY(STR_TO_DATE(CONCAT(#{endYm}, '-01'), '%Y-%m-%d'))
        GROUP BY month
        ORDER BY month;

    </select>

</mapper>
