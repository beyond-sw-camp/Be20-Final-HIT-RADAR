<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.hit.hradar.domain.evaluation.query.mapper.EvaluationAssignmentAdminMapper">

    <select id="findAssignmentsByCycleEvalType"
            parameterType="long"
            resultType="org.hit.hradar.domain.evaluation.query.dto.response.EvaluationAssignmentAdminResponse">

        SELECT
            a.assignment_id        AS assignmentId,

            c.cycle_id             AS cycleId,
            c.cycle_name           AS cycleName,
            c.year                 AS year,
            c.quarter              AS quarter,

            c.status               AS cycleStatus,

            et.eval_type_id        AS evalTypeId,
            et.type_name           AS evalTypeName,

            a.evaluator_id         AS evaluatorId,
            a.evaluatee_id         AS evaluateeId,

            a.assignment_status    AS assignmentStatus,
            a.submitted_at         AS submittedAt

        FROM evaluation_assignment a
                 JOIN cycle_evaluation_type cet
                      ON a.cycle_eval_type_id = cet.cycle_eval_type_id
                          AND cet.is_deleted = 'N'
                 JOIN cycle c
                      ON cet.cycle_id = c.cycle_id
                          AND c.is_deleted = 'N'
                 JOIN evaluation_type et
                      ON cet.eval_type_id = et.eval_type_id
                          AND et.is_deleted = 'N'

        WHERE a.cycle_eval_type_id = #{cycleEvalTypeId}
          AND a.is_deleted = 'N'

        ORDER BY
            a.assignment_status ASC,
            a.created_at ASC
    </select>

</mapper>
