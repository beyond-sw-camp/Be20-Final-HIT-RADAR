<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.hit.hradar.domain.attendance.command.infrastructure.mapper.AttendanceCorrectionMapper">

  <!-- 근태 정정 신청 저장 -->
  <insert id="insertCorrection"
    parameterType="org.hit.hradar.domain.attendance.command.domain.aggregate.AttendanceCorrection"
    useGeneratedKeys="true"
    keyProperty="attendanceCorrection">
    INSERT INTO attendance_correction (
    attendance_id,
    work_log_id,
    requester_emp_id,
    type,
    reason,
    requested_value,
    status,
    requested_at,
    is_deleted,
    reject_reason
    ) VALUES (
    #{attendanceId},
    #{workLogId},
    #{requesterEmpId},
    #{correctionType},
    #{reason},
    #{requestedValue},
    #{status},
    #{requestedAt},
    'N',
    ''
    )
  </insert>

  <!-- 정정 ID로 정정 요청 조회 -->
  <select id="selectByCorrectionId"
    parameterType="long"
    resultType="org.hit.hradar.domain.attendance.command.domain.aggregate.AttendanceCorrection">
    SELECT *
    FROM attendance_correction
    WHERE attendance_correction = #{correctionId}
    AND is_deleted = 'N'
  </select>

  <!-- 정정 상태 변경 (승인/반려) -->
  <update id="updateCorrectionStatus"
    parameterType="org.hit.hradar.domain.attendance.command.domain.aggregate.AttendanceCorrection">
    UPDATE attendance_correction
    SET
    status = #{status},
    decider_emp_id = #{deciderEmpId},
    decided_at = #{decidedAt},
    reject_reason = #{rejectReason}
    WHERE attendance_correction = #{attendanceCorrection}
  </update>

</mapper>